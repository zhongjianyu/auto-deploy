<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>Table</title>
<link rel="stylesheet" href="../../plugins/layui/css/layui.css" media="all" />
<link rel="stylesheet" href="../../css/global.css" media="all">
<link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../../css/table.css" />
</head>

<body>
	<input type="hidden" name="${_csrf.parameterName}" id="${_csrf.parameterName}" value="${_csrf.token}" />
	<div class="admin-main" style="margin: 10px;">
		<blockquote class="layui-elem-quote" style="padding: 5px;">
			<form class="layui-form" action="">
				<div class="layui-input-inline">
					<input type="text" name="searchKey" id="searchKey" placeholder="输入账号或昵称关键字" autocomplete="off" class="layui-input" style="height: 30px; line-height: 30px;">
				</div>
				<span><@a code="" href="javascript:void(0)" class="layui-btn layui-btn-small" id="do-search" onclick="loadData()" iclass="layui-icon"
					icon="&#xe615;" text="搜索"/></span>
				<div style="float: right;">
					<span><@a code="" href="javascript:void(0)" class="layui-btn layui-btn-small" id="zdy123" onclick="openAddUser()" iclass="layui-icon"
						icon="&#xe608;" text="新增用户"/></span>
				</div>
			</form>
		</blockquote>
		<div class="layui-field-box layui-form" style="padding-bottom: 22px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">
			<table class="layui-table admin-table">
				<thead>
					<tr>
						<th style="width: 20px;"><input type="checkbox" lay-skin="primary" lay-filter="paging_check-all"></th>
						<th style="display: none;">用户ID</th>
						<th>用户账号</th>
						<th>昵称</th>
						<th>是否激活</th>
						<th>是否过期</th>
						<th>是否被锁</th>
						<th>创建时间</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody id="paging-data">
					<script id="paging-script" type="text/html">
					{{each records value index}}
						<tr>
							<td><input type="checkbox" lay-skin="primary" class="check-id" id="{{value.id}}"></td>
							<td style="display: none;">{{value.id}}</td>
							<td>{{value.userName}}</td>
							<td>{{value.nickName}}</td>
							<td>{{if value.isActive == 1}}激活{{/if}}{{if value.isActive == 0}}冻结{{/if}}</td>
							<td>{{if value.isAccountExpired == 1}}过期{{/if}}{{if value.isAccountExpired == 0}}正常{{/if}}</td>
							<td>{{if value.isAccountLocked == 1}}锁定{{/if}}{{if value.isAccountLocked == 0}}正常{{/if}}</td>
							<td>{{value.createTime}}</td>
							<td>
								<@a code="" href="javascript:void(0)" class="layui-btn layui-btn-mini" id="show-edit" onclick="showEdit()" text="编辑"/>
								<@a code="" href="javascript:void(0)" class="layui-btn layui-btn-warm layui-btn-mini" id="show-view" onclick="showView()" text="预览"/>
								<!--
								<@a code="" href="javascript:void(0)" class="layui-btn layui-btn-normal layui-btn-mini" id="show-active" onclick="showActive()" text="激活"/>
								<@a code="" href="javascript:void(0)" class="layui-btn layui-btn-normal layui-btn-mini" id="show-disactive" onclick="showActive()" text="冻结"/>
								-->
								<@a code="" href="javascript:void(0)" class="layui-btn layui-btn-danger layui-btn-mini" id="show-delete" onclick="showDelete()" text="删除"/>
							</td>
						</tr>
					{{/each}}
					</script>
				</tbody>
			</table>
		</div>
		<div class="admin-table-page" style="border-width: 0px;">
			<div id="paging-footer" class="page" style="background-color: white; text-align: center;"></div>
		</div>
	</div>
	<!-- 新增用户窗口 -->
	<div style="padding: 10px; display: none; padding-right: 40px;" id="win-add-user">
		<form class="layui-form" id="add-user-form">
			<div class="layui-form-item">
				<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
				<label class="layui-form-label">账号</label>
				<div class="layui-input-block">
					<input type="text" name="userName" id="userName" lay-verify="required" autocomplete="off" placeholder="账号" class="layui-input">
				</div>
				<label class="layui-form-label">昵称</label>
				<div class="layui-input-block">
					<input type="text" name="nickName" id="nickName" lay-verify="required" autocomplete="off" placeholder="昵称" class="layui-input">
				</div>
				<label class="layui-form-label">密码</label>
				<div class="layui-input-block">
					<input type="password" name="userPwd" id="userPwd" lay-verify="required" autocomplete="off" placeholder="密码" class="layui-input">
				</div>
				<label class="layui-form-label">密码确认</label>
				<div class="layui-input-block">
					<input type="password" name="userPwd2" id="userPwd2" lay-verify="required|checkRepwd" autocomplete="off" placeholder="新密码确认" class="layui-input">
				</div>
				<label class="layui-form-label">是否激活</label>
				<@select dict="IS_ACTIVE" layVerify="required" id="isActive" name="isActive" class="layui-input-block" def=""/>
				<label class="layui-form-label">账号状态</label>
				<@select dict="IS_EXPIRED" layVerify="required" id="isAccountExpired" name="isAccountExpired" class="layui-input-block" def=""/>
				<label class="layui-form-label">是否锁定</label>
				<@select dict="IS_LOCKED" layVerify="required" id="isAccountLocked" name="isAccountLocked" class="layui-input-block" def=""/>
				<label class="layui-form-label">证书状态</label>
				<@select dict="IS_EXPIRED" layVerify="required" id="isCredentialsExpired" name="isCredentialsExpired" class="layui-input-block" def=""/>
				<div class="layui-input-block" style="text-align: right; margin-top: 15px;">
					<button class="layui-btn layui-btn-small" lay-submit="" lay-filter="form-add-submit">保存</button>
					<button type="reset" class="layui-btn layui-btn-small layui-btn-primary">重置</button>
				</div>
			</div>
		</form>
	</div>
	<script type="text/javascript" src="../../plugins/layui/layui.js"></script>
	<script type="text/javascript" src="../../plugins/layui/lay/modules/laypage.js"></script>
	<script type="text/javascript" src="../../js/template-web.js"></script>
	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/tool.js"></script>
	<script>
		//添加事件
		layui.use('form', function() {
			var form = layui.form();
			form.on('select(isActive)', function(data) {
				//alert(data.value);
				//form.render('checkbox');
			});
			//自定义表单校验
			form.verify({
				checkRepwd : function(value) {
					if (value != $("#userPwd").val()) {
						return "两次输入的密码不一致";
					}
				}
			});
			//监听提交
			form.on('submit(form-add-submit)', function(data) {
				tool.post("../autUser/add", $("#add-user-form").serialize(), postCallBack, false);
				return false;
			});
			//初始化出发数据加载
			loadData();
		});
		//加载数据
		function loadData() {
			var param = new Object();
			param.container = "paging";
			param.pageSize = 5;
			param.url = "../autUser/list";
			param.userName = $("#searchKey").val();
			tool.loadpage(param);
		}
		//获取勾选数据id
		function getCheckItmes() {
			$(".check-id:checked").each(function() {
				//console.log($(this).attr("id"));
				;
			});
		}
		//打开新增用户窗口
		function openAddUser() {
			var index = layer.open({
				title : '新增用户',
				maxmin : false,
				type : 1,
				content : $('#win-add-user')
			});
			layer.full(index);
		}
		//新增用户回调
		function postCallBack(retMsg) {
			if (retMsg.code == 0) {
				tool.success(retMsg.message);
				loadData();
			} else {
				tool.error(retMsg.message);
			}
		}
	</script>
</body>

</html>